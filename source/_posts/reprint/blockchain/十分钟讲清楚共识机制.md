---
title: 十分钟讲清楚共识机制
mathjax: true
copyright: true
original: true
explain: 文中可能会根据需要做部分调整
date: 2018-04-28 18:41:34
categories: [精品转载,区块链]
tags: [区块链,共识机制]
authorship: 微信（王晓韡 待字闺中）
srcpath: https://mp.weixin.qq.com/s/XvI_iQkN9i7uVPekYIHpuA
---
## 前言
区块链技术是目前金融领域的研究热点，共识机制是其技术框架中非常重要的一种技术。正是因为共识机制的存在，区块链才可以在分布式网络中达到一致性状态。本文中首先介绍了共识的基本概念，接着介绍了共识算法需要面对的问题，然后介绍了目前主流的共识算法,最后对共识算法进行了整体分析与比较。

## 基本概念
区块链是一种分布式记账系统。在分布式系统中，最为关键的问题就是一致性问题。一致性问题指的是对于给定一组服务器节点指定一系列操作，在某个协议保障下，使得各服务器节点对处理结果达成一致，其中用到的协议也被称作为共识算法。

共识算法在分布式系统中应用十分广泛，如领导选择问题中所有进程对领导达成一致、互斥问题中对于哪个进程进入临界区达成一致、区块链中记账问题的所有节点对账目达成一致都可以看作是共识算法需要解决的问题。

## 共识算法与容错
在实际的分布式系统应用环境中，通过共识算法达到一致性，往往需要面对服务器节点保障及服务器节点之间的网络通信故障等问题。上述问题可以分为两类情况，一类情况是仅发生服务器宕机、通讯协议不可靠、消息延迟或丢失等情况。另外一种情况则更加严重，网络中不仅可能存在上述问题，还可能存在某些恶意节点，他们向其他节点发送虚假或者错误消息。针对此类情况，相关研究人员专门提出了拜占庭将军问题用于描述此类问题。

拜占庭将军问题是由Leslie Lamport在1982年提出的，具体描述如下：拜占庭帝国派出了m支军队去围攻一个敌人。由于拜占庭的军队在不同的地点，所以必须在分开的包围状态下同时攻击。他们任一支军队单独进攻都毫无胜算，除非有多于n支军队同时袭击才能攻下敌国，而军队之间只能依靠通信兵相互通信来协商进攻意向及进攻时间。但是在拜占庭将军之间可能存在叛徒，这些叛徒的目的是通过故意传出虚假消息或者不传出任何消息等行为，来阻挠其他忠诚的将军达成一致的作战计划。

拜占庭将军问题是现实的分布式系统的模型化，其中的军队对应于分布式网络中的节点，是否能达成行动协议并消灭敌人对应于分布式网络中是否能达成一致性，而将军中的叛徒行为则对应于当计算机出现故障节点表现出前后不一致的情况，如信道不稳定、导致节点发送给其他节点的消息发生了错误，或者消息损坏等，上述分布式系统故障也被称为拜占庭错误。当分布式系统中仅出现消息丢失或者重复，但是不会出现内容损坏的情况则被称为非拜占庭错误。容错性指的处理这些异常或故障的协议。能够处理拜占庭错误的算法称为拜占庭容错，而能够处理非拜占庭错误的则被称为非拜占庭容错。

## 共识算法
不同的分布式系统，由于其故障类型不同，因此采用的共识算法也不同。根据处理的异常情况不同，同样可以分为两种类型，一种是针对非拜占庭错误的，这类算法性能较高，但容错性较差，如Paxos、Raft等，另一种是针对拜占庭错误的，这类算法往往容错性较高，但是性能相对较差，包括工作量证明（POW）、权益证明（POS）、股份授权证明（DPOS）、实用拜占庭容错算法（PBFT）等。处理拜占庭错误的算法有两种思路：
* 一种是通过提高作恶节点的成本以降低作恶节点出现的概率，如工作量证明、权益证明等，其中工作量证明是通过算力，而权益证明则是通过持有权益。
* 另外一种是在允许一定的作恶节点出现的前提下，依然使得各节点之间达成一致性，如实用拜占庭容错算法等。

下面对目前存在的主流共识算法做一简单介绍。
